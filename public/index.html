<!DOCTYPE html>
<html>
	<head>
		<title>智绪浩的个人主页</title>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" type="text/css" href="/vender/font-awesome/css/font-awesome.css">
		<link rel="stylesheet" type="text/css" href="/css/progressjs.css">
		<link rel="stylesheet" type="text/css" href="vender/simditor/simditor.css" />
		<script src="vender/jquery/dist/jquery.js"></script>
		<script src="js/turn.js"></script>
		<script src="js/progress.js"></script>
		<script type="text/javascript" src="vender/simditor/module.js"></script>
		<script type="text/javascript" src="vender/simditor/hotkeys.js"></script>
		<script type="text/javascript" src="vender/simditor/uploader.js"></script>
		<script type="text/javascript" src="vender/simditor/simditor.js"></script>
	</head>
	<body>
	<div id="porgress"></div>

		<div class="left-panel">
			<div class="self_intro">
				<div class="img_holder">
					<img src="image/lufei1.jpg">
				</div>
				<div class="title">
					<p>
						智绪浩的网站
					</p>
					<p>
						George's website
					</p>
				</div>
				<div class="icons">
					<i class="fa fa-envelope-o" aria-hidden="true"></i>
					<i class="fa fa-weixin" aria-hidden="true"></i>
					<i class="fa fa-weixin" aria-hidden="true"></i>
					<i class="fa fa-weixin" aria-hidden="true"></i>
					<i class="fa fa-weixin" aria-hidden="true"></i>
					<i class="fa fa-weixin" aria-hidden="true"></i>
				</div>
				<div class="intro_text">
					<p>
						我今年23岁,热爱前端,希望自己的作品能被更多人看到,深知自己的不足,所以渴求新的知识,盼望与牛逼的人做牛逼的事! best wishes!
					</p>
				</div>
			</div>
			<div class="recent_work">

			</div>
			<div class="news">

			</div>
		</div>
		<div class="right-panel">
			<div class="myNote">
				<div class="addNote" id="addNote">
					<div class="icon">
						<a onclick="addnote(this)"><i class="fa fa-plus" aria-hidden="true"></i></a>
					</div>
					<form id="add-Note">
						<div class="adiv-title">
							<input class="input-title" placeholder="请输入标题">
						</div>
						<div class="adiv-describe">
							<input class="input-describe" placeholder="请输入描述">
						</div>
						<div class="adiv-content">
							<textarea id="simditor_area" placeholder="请输入内容"></textarea>
						</div>
						<div class="adiv-class">
							<label><input type="radio" name="note-class" checked value="knowledge"><span>知识点</span></label>
							<label><input type="radio" name="note-class" value="fromWork"><span>工作</span></label>
							<label><input type="radio" name="note-class" value="collection"><span>整理</span></label>
						</div>
						<div class="adiv-button">
							<button type="button" id="post_button" onclick="post_note()">提交</button>
						</div>
					</form>
				</div>
				<p class="title" onclick="getAllNotes()">学习笔记</p>
				<div class="article-wrapper" id="article-wrapper">
				<!--	<article class="note" data-target="/detail/1">
						<p class="article-title">
							accesskey 用法
						</p>
						<p class="content">
							accesskey 是快捷键，可以用使得元素获得焦点，比如跳转超链接，或者input输入，Alt + accessKey (或者 Shift + Alt + accessKey)，mac是control+option+accessKey
						</p>
						<p class="footer">
							<span>发布于2016-10-01 15:30</span>
							<span>标签</span>
							<span>收藏</span>
						</p>
					</article>
					<article class="note" data-target="/detail/2">
						<p class="article-title">
							accesskey 用法
						</p>
						<p class="content">
							accesskey 是快捷键，可以用使得元素获得焦点，比如跳转超链接，或者input输入，Alt + accessKey (或者 Shift + Alt + accessKey)，mac是control+option+accessKey
						</p>
						<p class="footer">
							<span>发布于2016-10-01 15:30</span>
							<span>标签</span>
							<span>收藏</span>
						</p>
					</article>
					<article class="note" data-target="/detail/3">
						<p class="article-title">
							accesskey 用法
						</p>
						<p class="content">
							accesskey 是快捷键，可以用使得元素获得焦点，比如跳转超链接，或者input输入，Alt + accessKey (或者 Shift + Alt + accessKey)，mac是control+option+accessKey
						</p>
						<p class="footer">
							<span>发布于2016-10-01 15:30</span>
							<span>标签</span>
							<span>收藏</span>
						</p>
					</article>
					<article class="note" data-target="/detail/4">
						<p class="article-title">
							accesskey 用法
						</p>
						<p class="content">
							accesskey 是快捷键，可以用使得元素获得焦点，比如跳转超链接，或者input输入，Alt + accessKey (或者 Shift + Alt + accessKey)，mac是control+option+accessKey
						</p>
						<p class="footer">
							<span>发布于2016-10-01 15:30</span>
							<span>标签</span>
							<span>收藏</span>
						</p>
					</article>
					<article class="note" data-target="/detail/5">
						<p class="article-title">
							accesskey 用法
						</p>
						<p class="content">
							accesskey 是快捷键，可以用使得元素获得焦点，比如跳转超链接，或者input输入，Alt + accessKey (或者 Shift + Alt + accessKey)，mac是control+option+accessKey
						</p>
						<p class="footer">
							<span>发布于2016-10-01 15:30</span>
							<span>标签</span>
							<span>收藏</span>
						</p>
					</article>
					-->
				</div>
			</div>
		</div>
	<script>

	</script>
	<script>
		var type ="{{title}}";


		function addnote(obj){
			var div = $(obj).parent().parent();
			if(div.hasClass('active')){
				div.removeClass('active');
				return;
			}
			else{
				div.addClass('active');
			}
		}


		function getNoteDetail(filename,func){
			var postdata = {
				filename:filename
			};
			$.ajax({
				contentType:'application/json;charset=UTF-8',
				type: "POST",
				url: location.origin+"/noteDetail/",
				dataType: "json",
				data:JSON.stringify(postdata),
				success: function(data){
					func(data,filename);
				}
			});

		}


		function showNoteDetail(data,filename){
			progressJs("#porgress").start();
			$("#article-wrapper").css("opacity",0);
			progressJs("#porgress").set(50);
			var $title = $("<p>").addClass("article-title");
			$title.text(data.title);
			var $time = $("<span>").html("发布于"+time_transfer(data.time));
			var $tag = $("<span>").html(data.class);
			var $alterspan = $("<span>").text("修改").addClass("alterSpan");
			$alterspan.bind("click",function(){
				alterNote($(this).parent().parent().attr("data-target"));
			});
			var $deletespan = $("<span>").text("删除").addClass("deleteSpan");
			$deletespan.bind("click",function(){
				deleteNote($(this).parent().parent().attr("data-target"));
			});
			var $footer = $("<p>").addClass("footer");
			$footer.append($time,$tag,$alterspan,$deletespan);
			var $content = $("<p>").addClass("content").html(data.content);
			var $article = $("<article>").addClass("note-detail").addClass(data.class).append($title,$content,$footer).attr("data-target",filename);
			setTimeout(function(){
				$("#article-wrapper").empty();
				$("#article-wrapper").append($article);
				$("#article-wrapper").css("opacity",1);
				progressJs("#porgress").end();
			},500);
		}

		$(document).ready(function(){
			initSimditor();
			getAllNotes();
		});

		function initSimditor(){
			var editor = new Simditor({
				textarea: $("#simditor_area"),
				toolbar: toolbar,
				imageButton: "upload",
				pasteImage: true,
				upload: {
					url: location.origin + "/noteimg/upload/",
					formData : {
						"childPath" : "picture"
					},
					fileKey: "file",
					leaveConfirm: "上传正在进行，您确定要离开本页面？"
				}
			});
		}


		function getAllNotes(){
			$.ajax({
				contentType:'application/json;charset=UTF-8',
				type: "POST",
				url: location.origin+'/'+type+'/',
				dataType: "json",
				success:function(data){
					data.sort(function(a,b){
						if(a.time < b.time){
							return 1;
						}
						else if(a.time > b.time){
							return -1;
						}
						return 0;
					});
					console.log(data);
					showNotes(data);
				}
			});
		}


		function alterNote(filename){
			$("#addNote").addClass("active");
			$("#post_button").text("保存修改");
			var showAlterEditor = function(data,filename){
				var title = $("input.input-title").eq(0);
				var describe = $("input.input-describe").eq(0);
				var content = $(".simditor-body").eq(0);
				var placeholder = $(".simditor-placeholder").eq(0);
				title.val(data.title);
				describe.val(data.describe);
				placeholder.empty();
				content.html(data.content);
				$("input[value="+data.class+"]").prop("checked",true);
			};
			getNoteDetail(filename,showAlterEditor);
			$("#post_button")[0].onclick = function(){
				post_note(true,filename);
			};
		}


		function deleteNote(filename){
			var postdata =  new Object();
			postdata.filename = filename;
			$.ajax({
				contentType:'application/json;charset=UTF-8',
				type: "POST",
				url: location.origin+'/deleteNote/',
				dataType: "json",
				data:JSON.stringify(postdata),
				success:function(data){
					alert("删除成功");
					getAllNotes();
				}
			});
		}

		//所有笔记
		function showNotes(data){
			var $articleWrapper = $("#article-wrapper");
			progressJs("#porgress").start();
			$articleWrapper.css("opacity",0);
			setTimeout(function(){
				$articleWrapper.empty();
				for(var i = 0; i < data.length; i++){
					var $article = $("<article>").addClass("note").addClass(data[i].class).attr("data-target",data[i].time.toString()+"_"+data[i].class.toString());
					var $atitle = $("<p>").addClass("article-title").text(data[i].title.toString());
					var $acontent = $("<p>").addClass("content").text(data[i].describe.toString());
					var $afooter = $("<p>").addClass("footer");
					var $timespan = $("<span>").text("发布于 "+time_transfer(data[i].time));
					var $classspan = $("<span>").addClass("classSpan").text(data[i].class);
					var $alterspan = $("<span>").addClass("alterSpan").text("修改");
					$alterspan.bind("click",function(){
						alterNote($(this).parent().parent().attr("data-target"),"all");
					});
					var $deletespan = $("<span>").text("删除").addClass("deleteSpan");
					$deletespan.bind("click",function(){
						deleteNote($(this).parent().parent().attr("data-target"),"all");
					});
					$afooter.append($timespan).append($classspan).append($alterspan).append($deletespan);
					$article.append($atitle).append($acontent).append($afooter);
					var arg = data[i].time.toString()+"_"+data[i].class.toString();
					$atitle.bind("click",function(){
						getNoteDetail($(this).parent().attr("data-target"),showNoteDetail);
					});
					$articleWrapper.append($article);
				}
				$articleWrapper.css("opacity",1);
				progressJs("#porgress").end();
			},500);
		}


		//提交笔记
		function post_note(isAlter,filename,arg){
			var url = '/addnote/';
			var title = $("input.input-title").eq(0);
			var describe = $("input.input-describe").eq(0);
			var content = $(".simditor-body").eq(0);
			var postdata = getNoteData(title,describe,content);
			if(isAlter){
				url = '/alternote/';
				postdata.orifilename = filename;
			}
			$.ajax({
				contentType:'application/json;charset=UTF-8',
				type: "POST",
				url: location.origin+url,
				dataType: "json",
				data:JSON.stringify(postdata),
				success: function(data){
					title.val("");
					describe.val("");
					content.html("");
					$("#addNote").removeClass("active");
					alert("上传成功");
					$("#post_button")[0].onclick = function(){
						post_note();
					};
					getAllNotes();
				}
			});
		}

		//得到笔记的信息
		function getNoteData(title,describe,content){
			var postdata = new Object();
			var type = $("input[name='note-class']:checked").val();
			postdata.time = Date.now();
			postdata.title = title.val().toString();
			postdata.describe = describe.val().toString();
			postdata.content = content.html().toString();
			postdata.class = type;
			return postdata;
		}

		//转换时间
		function time_transfer(t){
			var date = new Date(t);
			Y = date.getFullYear() + '-';
			M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
			D = (date.getDate() < 10 ? '0'+(date.getDate()) : date.getDate()) + ' ';
			h = (date.getHours() < 10 ? '0'+(date.getHours()) : date.getHours())+':';
			m = (date.getMinutes() < 10 ? '0'+(date.getMinutes()) : date.getMinutes())+'';
			return Y+M+D+h+m;
		}
	</script>
	</body>
</html>